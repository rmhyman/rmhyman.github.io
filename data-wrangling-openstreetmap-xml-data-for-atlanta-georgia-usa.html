<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Data Wrangling OpenStreetMap XML Data for Atlanta, Georgia, USA</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="A Pelican Blog Atom Feed" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">A Pelican Blog </a></h1>
                <nav><ul>
                    <li class="active"><a href="/category/data-science.html">Data Science</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/data-wrangling-openstreetmap-xml-data-for-atlanta-georgia-usa.html" rel="bookmark"
           title="Permalink to Data Wrangling OpenStreetMap XML Data for Atlanta, Georgia, USA">Data Wrangling OpenStreetMap XML Data for Atlanta, Georgia, USA</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-06-12T00:00:00+00:00">
                Published: Sun 12 June 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/ransford-hyman-jr.html">Ransford Hyman Jr.</a>
                        <a class="url fn" href="/author/phd.html">Ph.D.</a>
        </address>
<p>In <a href="/category/data-science.html">Data Science</a>.</p>
<p>tags: <a href="/tag/python.html">Python</a> <a href="/tag/mongodb.html">MongoDB</a> <a href="/tag/wrangling.html">Wrangling</a> <a href="/tag/xml.html">XML</a> <a href="/tag/mapreduce.html">MapReduce</a> </p>
</footer><!-- /.post-info -->      <h1>Problems Encountered in the Map</h1>
<p>Since Atlanta is traditionally street names seperated into <em>oridinal directions</em>, majority of the street names end with one of these oridinal directions (Southwest, Southeast, etc..). Although all of the street names that end with an ordinal direction seemed to have been cleaned well, I thought it would be appropriate to move the direction into a seperate key/value pair.  Thus we will add the key attribute <strong>streetSuffix</strong> to the dataset to describe the ordinal direction of the street.  There are some street names that have some abbreviations as well as some numbers in the street names. The cleaning plan is as follows:
- Fix street names that end with a direction initial and expand them to the full name
- Move all street names direction suffix to a new key/value pair called <em>streetSuffix</em>
- Fix all abbreviated street names(Dr., Ave., Blvd.) to their full name</p>
<p>There are only a small number of addresses with numbers at the end so we will omit them in this project. Most of them belonged to a state Highway.</p>
<h2>Auditing Process on Postal Codes</h2>
<p>Some of the postal codes have the full 9 digit code, and there are some that have the State code as a prefix.  Thus our cleaning process will involve:
- Removing the state code from the postal codes
- Move the last 4 digits of the postal code into a new key/value pair called <em>postExt</em></p>
<p>The golden standard of the postal codes was generated by Screen Scraping <strong>zipcodestogo.com</strong>. After a initial audit, I noticed that a large portion of the zipcodes do not belong to the City of Atlanta. Therefore I generated a seperate key/value pair called <em>zipInAtlanta</em> so that we can perform an analysis on how many entries do not belong to the City of Atlanta.</p>
<h2>Auditing Process on County field</h2>
<p>Looking at the county field, I saw that the none of the counties reside in the City of Atlanta. Also, some of the counties have the state code appended to it. Thus as part of the cleaning process, we remove the state code from the end of the county field.   After performing an audit on a sample set, it seems that a good portion of the counties are counties that are not in the City of Atlanta, but belong to the Atlanta Metropolitan area.</p>
<h2>Data Overview</h2>
<p>We first run some queries to find out the number of entries and some other auxillary data.</p>
<h3>Size of OSM file</h3>
<p>atlanta_georgia.osm - <strong>2.27GB</strong></p>
<div class="highlight"><pre><span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">MongoClient</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">MongoClient</span><span class="p">(</span><span class="s">&quot;mongodb://localhost:27017&quot;</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">osm</span>


<span class="n">count</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">atlanta</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>


<span class="n">entries_with_address</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;address&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s">&quot;$exists&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
<span class="n">addr_entries</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">atlanta</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="n">entries_with_address</span><span class="p">)</span>


<span class="n">entries_with_pos</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;pos&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s">&quot;$exists&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
<span class="n">pos_entries</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">atlanta</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="n">entries_with_pos</span><span class="p">)</span>


<span class="n">entries_with_postcodes</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;address.postcode&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s">&quot;$exists&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">}}</span>
<span class="n">postcode_entries</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">atlanta</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="nb">filter</span><span class="o">=</span><span class="n">entries_with_postcodes</span><span class="p">)</span>


<span class="k">print</span> <span class="s">&quot;Number of entries in database &quot;</span><span class="p">,</span> <span class="n">count</span>
<span class="k">print</span> <span class="s">&quot;Entries with an address field: &quot;</span><span class="p">,</span><span class="n">addr_entries</span>
<span class="k">print</span> <span class="s">&quot;Entries with postcodes: &quot;</span><span class="p">,</span><span class="n">postcode_entries</span>
<span class="k">print</span> <span class="s">&quot;Entries with position information&quot;</span><span class="p">,</span> <span class="n">pos_entries</span>

<span class="n">Number</span> <span class="n">of</span> <span class="n">entries</span> <span class="ow">in</span> <span class="n">database</span>  <span class="mi">12167874</span>
<span class="n">Entries</span> <span class="k">with</span> <span class="n">an</span> <span class="n">address</span> <span class="n">field</span><span class="p">:</span>  <span class="mi">100744</span>
<span class="n">Entries</span> <span class="k">with</span> <span class="n">postcodes</span><span class="p">:</span>  <span class="mi">82402</span>
<span class="n">Entries</span> <span class="k">with</span> <span class="n">position</span> <span class="n">information</span> <span class="mi">11390067</span>
</pre></div>


<p>From these inital queries, it seems although many entries have position information, and less than 1% have address information.  Most of the entries with address information seem to have the postal code information as well which is a good thing.</p>
<h2>Which street suffix was used the most in the address's street names?</h2>
<p>As I stated above, all street names in the city of Atlanta end with a ordinal direction as a suffix.  Here we find out which street suffix is the most used in our address field. This may give us some insight as to which quandrant of the city is best documented.</p>
<div class="highlight"><pre><span class="x">match_pipe = </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">match</span><span class="x">&quot; : </span><span class="err">{</span><span class="x">&quot;address&quot; : </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">exists</span><span class="x">&quot; : 1}}}</span>
<span class="x">group_pipe = </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">group</span><span class="x">&quot; : </span><span class="err">{</span><span class="x">&quot;_id&quot; : &quot;</span><span class="p">$</span><span class="nv">address</span><span class="p">.</span><span class="nv">streetSuffix</span><span class="x">&quot;, &quot;count&quot; : </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">sum</span><span class="x">&quot; : 1}}}</span>
<span class="x">sort_pipe = </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">sort</span><span class="x">&quot; : </span><span class="err">{</span><span class="x">&quot;count&quot; : -1}}</span>
<span class="x">pipeline = [match_pipe,group_pipe,sort_pipe]</span>
<span class="x">result = db.atlanta.aggregate(pipeline)</span>
<span class="x">for entry in result:</span>
<span class="x">    print(entry)</span>

<span class="err">{</span><span class="x">u&#39;count&#39;: 88496, u&#39;_id&#39;: None}</span>
<span class="err">{</span><span class="x">u&#39;count&#39;: 4261, u&#39;_id&#39;: u&#39;Northwest&#39;}</span>
<span class="err">{</span><span class="x">u&#39;count&#39;: 3158, u&#39;_id&#39;: u&#39;Northeast&#39;}</span>
<span class="err">{</span><span class="x">u&#39;count&#39;: 2995, u&#39;_id&#39;: u&#39;Southwest&#39;}</span>
<span class="err">{</span><span class="x">u&#39;count&#39;: 1602, u&#39;_id&#39;: u&#39;Southeast&#39;}</span>
<span class="err">{</span><span class="x">u&#39;count&#39;: 101, u&#39;_id&#39;: u&#39;East&#39;}</span>
<span class="err">{</span><span class="x">u&#39;count&#39;: 51, u&#39;_id&#39;: u&#39;South&#39;}</span>
<span class="err">{</span><span class="x">u&#39;count&#39;: 50, u&#39;_id&#39;: u&#39;West&#39;}</span>
<span class="err">{</span><span class="x">u&#39;count&#39;: 30, u&#39;_id&#39;: u&#39;North&#39;}</span>
</pre></div>


<p>It seems that Northwest Atlanta is the most used street suffix.  As a fun fact, I went to high school on this side of town.  Most entries in this dataset don't have a suffix at all which hints to me that this dataset is mostly the Atlanta Metro Area outside the city limits.</p>
<h2>What is the ratio of Zipcodes that are actually in the City of Atlanta?</h2>
<p>To further my hypothesis of whether most of the entries are not in the city of Atlanta, I seek out to find out how many of the zipcodes actually are within the city of Atlanta</p>
<div class="highlight"><pre><span class="x">match_pipe = </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">match</span><span class="x">&quot; : </span><span class="err">{</span><span class="x">&quot;address.zipInAtlanta&quot; : </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">exists</span><span class="x">&quot; : 1}}}</span>
<span class="x">group_pipe = </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">group</span><span class="x">&quot; : </span><span class="err">{</span><span class="x">&quot;_id&quot; : &#39;null&#39;, &quot;count&quot; : </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">sum</span><span class="x">&quot; : 1}}}</span>
<span class="x">pipeline = [match_pipe,group_pipe]</span>
<span class="x">result = db.atlanta.aggregate(pipeline)</span>
<span class="x">total = 0</span>
<span class="x">for entry in result:</span>
<span class="x">    total = entry[&#39;count&#39;]</span>
<span class="x">    print(entry)</span>

<span class="err">{</span><span class="x">u&#39;count&#39;: 82402, u&#39;_id&#39;: u&#39;null&#39;}</span>



<span class="x">match_pipe = </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">match</span><span class="x">&quot; : </span><span class="err">{</span><span class="x">&quot;address.zipInAtlanta&quot; : &#39;T&#39;}}</span>
<span class="x">group_pipe = </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">group</span><span class="x">&quot; : </span><span class="err">{</span><span class="x">&quot;_id&quot; : &quot;</span><span class="p">$</span><span class="nv">address</span><span class="p">.</span><span class="nv">zipInAtlanta</span><span class="x">&quot;, &quot;count&quot; : </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">sum</span><span class="x">&quot; : 1}}}</span>
<span class="x">pipeline = [match_pipe,group_pipe]</span>
<span class="x">result = db.atlanta.aggregate(pipeline)</span>
<span class="x">in_atl = 0</span>
<span class="x">for entry in result:</span>
<span class="x">    in_atl = entry[&#39;count&#39;]</span>
<span class="x">    print(entry)</span>

<span class="err">{</span><span class="x">u&#39;count&#39;: 17895, u&#39;_id&#39;: u&#39;T&#39;}</span>



<span class="x">print &quot;Ratio of zip codes entries that are in Atlanta City Limits:&quot;, float(in_atl)/float(total)</span>

<span class="x">Ratio of zip codes entries that are in Atlanta City Limits: 0.217167059052</span>
</pre></div>


<p>The fact that only 22% of zip codes are within the city limits increases my confidence that majority of this dataset is Atlanta Metro Area.  One can also conclude that most of the contributions are done on areas not within the city of Atlanta.</p>
<h2>Which Zipcode is the most common?</h2>
<div class="highlight"><pre><span class="x">match_pipe = </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">match</span><span class="x">&quot; : </span><span class="err">{</span><span class="x">&quot;address.postcode&quot; : </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">exists</span><span class="x">&quot; : 1}}}</span>
<span class="x">group_pipe = </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">group</span><span class="x">&quot; : </span><span class="err">{</span><span class="x">&quot;_id&quot; : &quot;</span><span class="p">$</span><span class="nv">address</span><span class="p">.</span><span class="nv">postcode</span><span class="x">&quot;, &quot;count&quot; : </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">sum</span><span class="x">&quot; : 1}}}</span>
<span class="x">sort_pipe = </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">sort</span><span class="x">&quot; : </span><span class="err">{</span><span class="x">&quot;count&quot; : -1}}</span>
<span class="x">limit_pipe = </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">limit</span><span class="x">&quot; : 1}</span>
<span class="x">pipeline = [match_pipe,group_pipe,sort_pipe,limit_pipe]</span>
<span class="x">result = db.atlanta.aggregate(pipeline)</span>
<span class="x">for entry in result:</span>
<span class="x">    print entry</span>

<span class="err">{</span><span class="x">u&#39;count&#39;: 7259, u&#39;_id&#39;: 30114}</span>
</pre></div>


<p>This zipcode belongs to Canton, Georgia which is apart of the Atlanta Metropolitan area.</p>
<h2>What is the most common amenity in Atlanta?</h2>
<div class="highlight"><pre><span class="x">match_pipe = </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">match</span><span class="x">&quot; : </span><span class="err">{</span><span class="x">&quot;amenity&quot; : </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">exists</span><span class="x">&quot; : 1}}}</span>
<span class="x">group_pipe = </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">group</span><span class="x">&quot; : </span><span class="err">{</span><span class="x">&quot;_id&quot; : &quot;</span><span class="p">$</span><span class="nv">amenity</span><span class="x">&quot;, &quot;count&quot; : </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">sum</span><span class="x">&quot; : 1}}}</span>
<span class="x">sort_pipe = </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">sort</span><span class="x">&quot; : </span><span class="err">{</span><span class="x">&quot;count&quot; : -1}}</span>
<span class="x">limit_pipe = </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">limit</span><span class="x">&quot; : 1}</span>
<span class="x">pipeline = [match_pipe,group_pipe,sort_pipe,limit_pipe]</span>
<span class="x">result = db.atlanta.aggregate(pipeline)</span>
<span class="x">for entry in result:</span>
<span class="x">    print entry</span>

<span class="err">{</span><span class="x">u&#39;count&#39;: 5609, u&#39;_id&#39;: u&#39;place_of_worship&#39;}</span>
</pre></div>


<p>There is no surprise that the most common amenity is a place of worship.  The only thing bigger than Texas in the Southern U.S. is Religion.</p>
<h2>Which user contributed the most to this dataset?</h2>
<div class="highlight"><pre><span class="x">group_pipe = </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">group</span><span class="x">&quot; : </span><span class="err">{</span><span class="x">&quot;_id&quot; : &quot;</span><span class="p">$</span><span class="nv">created</span><span class="p">.</span><span class="nv">user</span><span class="x">&quot;, &quot;count&quot; : </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">sum</span><span class="x">&quot; : 1}}}</span>
<span class="x">sort_pipe = </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">sort</span><span class="x">&quot; : </span><span class="err">{</span><span class="x">&quot;count&quot; : -1}}</span>
<span class="x">limit_pipe = </span><span class="err">{</span><span class="x">&quot;</span><span class="p">$</span><span class="nv">limit</span><span class="x">&quot; : 1}</span>
<span class="x">pipeline = [match_pipe,group_pipe,sort_pipe,limit_pipe]</span>
<span class="x">result = db.atlanta.aggregate(pipeline)</span>
<span class="x">for entry in result:</span>
<span class="x">    print entry</span>

<span class="err">{</span><span class="x">u&#39;count&#39;: 4057, u&#39;_id&#39;: u&#39;iandees&#39;}</span>
</pre></div>


<p>This doesn't look like a bot name so I must commend <em>iandees</em> for making so many contributions to the Atlanta OSM map.</p>
<h2>Additional Ideas for improving the dataset</h2>
<p>Since this dataset is the Atlanta Metro area, it would be nice if the county field was more populated so that one can perform data analysis on a county by county granularity.  There are quite a few counties within the Atlanta Metro area so it is worthy field within the dataset.  Also there needs to be an audit on the data to remove the data generated by the <strong>TIGER</strong> project as most of the entries I saw didn't seem correct(Most of them seem to belong to Alabama), but these were <em>way</em> nodes and there was not a lot of auditing done by me on the <em>way</em> nodes.  Another analysis that I thought would be good to do is get the min/max longitude and latitude values to assure that all of the entries are within the Atlanta Metro boundaries.  Below I give some other suggestions to not only improve the City of Atlanta's dataset, but OpenStreetMap data as a whole.</p>
<h3>University-level involvement</h3>
<p>There are two big universities in downtown Atlanta (Georgia State University, and Georgia Institute of Technology) that could become involved with the OSM project.  There are many core concepts that can be learned by the students while cleaning up the dataset in the process.  Some that comes to mind are:
- Data Structures course:  Have a project assignment in which students create a data structure that generates a standard document format. For extra credit, students could submit their changes to OSM for review
- Algorithms course: Have an assignment in which students creates an algorithm that takes some OSM data as input and outputs the data in some given format.  The assignment could be tailored in which students will try to create the most optimal algorithm and evaluate the run-time of their algorithm.</p>
<p>The benefits of this idea is that it gives students some hands-on experience with real-world application of the knowledge they have obtained while also giving benefits to the OSM community.</p>
<h3>Challenge-based involvement</h3>
<p>Another opportunity for improving the dataset is to turn it into a challenge or contest on platforms such as <strong>Kaggle</strong> or <strong>Hackerrank</strong>.  Participants could be given a unique but constant size dataset that is similar in complexity and see who can clean the data the fastest.  Submissions could be passed into a checker tool which can give some measurement of how clean the dataset is based on some given criteria. The participants with the highest measure of "cleanliness" wins the challenge. The challenges could be sweetened by giving away some prizes such as T-shirts or some award plaque that could be added to one's professional profile.</p>
<h3>Global Day of Cleaning OpenStreetMap</h3>
<p>Similar to the Global Day of CodeRetreat, the OSM community could hold a Global Day of Cleaning OpenStreetMap.  The event could also be driven by professional organizations such as ACM or IEEE in which each chapter can register for the event.  To avoid duplication, there could be central sites for the various regions that are participating and they could be assigned data within some perimeter of their location.  Each team could share their progress by posting before/after pictures of maps that they cleaned onto a specific site or through social media.  One drawback from this method is that areas where there is not any expertise in working with OSM data gets left out.  So as an alternative strategy, the OSM community could select regions where there are no participants or have limited resources due to their economic circumstances and have programmers around the world help clean up the map data in those areas.  This brings a "social good" proponent to the activity which benefits the global community.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>